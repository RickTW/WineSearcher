<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ricerca Google Sheet</title>
  <style>
    .selected-row {
      background-color: rgb(171, 245, 231) !important;
    }
    /* Colori normali delle ultime 3 colonne */
    .col-last-3 {
      background-color: rgb(250, 247, 99);
    }
    .col-last-2 {
      background-color: rgb(250, 179, 87);
    }
    .col-last-1 {
      background-color: rgb(123, 192, 91);
    }
    /* Colori delle ultime 3 colonne quando la riga è selezionata */
    .selected-row .col-last-3 {
      background-color: rgb(255, 244, 171) !important;
    }
    .selected-row .col-last-2 {
      background-color: rgb(255, 209, 155) !important;
    }
    .selected-row .col-last-1 {
      background-color: rgb(191, 255, 161) !important;
    }
    /* Testo Centrato */
    .centered {
      text-align: center;
    }
    .input-row {
      display: flex;
      align-items: center;
      margin-top: 20px;
      margin-bottom: 20px;
      /* spazio sopra e sotto */
    }
    .input-row label {
      margin-right: 8px;
    }
    .input-row input[type="text"] {
      margin-right: 8px;
    }
  </style>
</head>

<body>
  <div class="input-row">
    <label for="vinoInput">Vino: </label>
    <input type="text" id="vinoInput" name="vino">
    <button onclick="cerca()">Cerca</button>
  </div>
  <div id="risultato"></div>
  <script>
    function cerca() {
      var q = document.getElementById('query').value;
      fetch('https://script.google.com/macros/s/AKfycbyNmo2quON4lUSkVhlm4jdBpuptHCdH0sR5Ifkkrt_VddeoaWySmEwXLYMaMhNxHeGL/exec?q=' + encodeURIComponent(q))
        .then(r => r.text()) // Prendi sempre come testo
        .then(t => {
          let arr;
          try {
            arr = JSON.parse(t);
          } catch {
            // Non è JSON, quindi è un messaggio di errore o "Not found"
            document.getElementById('risultato').innerText = t;
            return;
          }
          if (!Array.isArray(arr) || arr.length === 0) {
            document.getElementById('risultato').innerText = "Nessun risultato";
            return;
          }

          let html = "<table border='1'><tr>" +
            "<th class='centered'>NAZIONE</th>" +
            "<th class='centered'>REGIONE</th>" +
            "<th class='centered'>PRODUTTORE</th>" +
            "<th class='centered'>VINO</th>" +
            "<th class='centered'>ANNATA</th>" +
            "<th class='centered'>FORMATO</th>" +
            "<th class='centered'>PREZZO SERVIZIO</th>" +
            "<th class='centered'>PREZZO ASPORTO</th>" +
            "<th class='centered'>PREZZO CALICE</th></tr>";

          arr.forEach((row, rowIdx) => {
            html += `<tr onclick="selezionaRiga(this)">`;
            row.forEach((cell, idx) => {
              // Ultime 3 colonne: idx 6, 7, 8 (per colorazione)
              let tdClass = "";
              if (idx === row.length - 3) tdClass = "col-last-3";
              else if (idx === row.length - 2) tdClass = "col-last-2";
              else if (idx === row.length - 1) tdClass = "col-last-1";

              // Colonne da centrare: 4,5,6,7,8
              if (idx >= 4) tdClass += (tdClass ? " " : "") + "centered";

              html += `<td${tdClass ? ` class="${tdClass}"` : ""}>${cell}</td>`;
            });
            html += "</tr>";
          });
          html += "</table>";
          document.getElementById('risultato').innerHTML = html;
        })
        .catch(err => {
          document.getElementById('risultato').innerText = "Errore nella richiesta: " + err;
        });
    }

    // Funzione globale per selezionare la riga
    window.selezionaRiga = function (tr) {
      document.querySelectorAll("#risultato tr").forEach(r => r.classList.remove("selected-row"));
      tr.classList.add("selected-row");
    }
  </script>
</body>

</html>
